## 1. 全局内存的合理使用

全局内存，即通常意义上的显存，具有最大的容量，但是访问速度最低，往往是 CUDA 程序的性能瓶颈。

### 1.1 合并访问

从费米架构开始，全局内存有 SM 层次的 L1 缓存和设备层次的 L2 缓存。缓存的作用和 CPU 类似。访问全局内存时先访问缓存查看数据是否在缓存中。类似 CPU 的 cacheline，缓存和 SM，缓存和全局内存，一次交换多个数据，一般为 32 字节。比如我需要传输 128 字节的数据，那么理想情况下只需要 4 次数据传输。

对于全局内存的访问，有合并和非合并两种类型， 如果一个线程束对全局内存的一次访问（读或者写）导致最少数量的数据传输，则该次访问是合并的，否则是非合并的。一个量化的描述程序访存情况的指标是合并度，即 SM 程序需要的数据除以实际传输的数据。提升访存的合并度可以减少访存延迟，提升程序的性能。提升合并度的常用方法如下：

1. 需要访存的程序，线程块内线程的数量尽量为 32 的倍数；
2. 一个线程束内的线程访问的数据尽量是连续的；
3. 写合并优于读合并。

对于第三点，这是因为编译器如果判断一个全局内存变量在核函数范围内是制度的，会调用 __ldg() 函数对数据的读取进行缓存。缓解读数据的非合并访问带来的影响。


## 2. 共享内存的合理使用

## 3. 避免 bank confict 